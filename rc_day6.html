<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아두이노 RC카 교실 6주차 교재: RC카 '자율 주행'의 첫걸음 (장애물 회피)</title>
    <style>
        body {
            font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif;
            line-height: 1.6;
            margin: 20px;
            padding: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: auto;
            background: #fff;
            padding: 30px 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            margin-bottom: 40px;
            font-size: 2.2em;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #eee;
            padding-bottom: 8px;
            margin-top: 35px;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        h3 {
            color: #2980b9;
            margin-top: 25px;
            margin-bottom: 12px;
            font-size: 1.4em;
        }
        h4 {
            color: #1a5276;
            margin-top: 15px;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        ul {
            list-style-type: disc;
            margin-left: 25px;
            margin-bottom: 15px;
        }
        ol {
            list-style-type: decimal;
            margin-left: 25px;
            margin-bottom: 15px;
        }
        b {
            color: #e74c3c; /* 강조 색상 */
            font-weight: bold;
        }
        .highlight {
            background-color: #eaf6ff;
            padding: 2px 5px;
            border-radius: 3px;
        }
        pre {
            background-color: #ecf0f1;
            padding: 18px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 0.95em;
            margin-bottom: 20px;
            border: 1px solid #c0d8e8;
        }
        code {
            font-family: 'Consolas', 'Courier New', monospace;
            background-color: #e0e0e0;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .note {
            background-color: #fdf6e3;
            border-left: 5px solid #f39c12;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .project-idea {
            background-color: #e8f6f3;
            border-left: 5px solid #1abc9c;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .task {
            background-color: #e0f2f7;
            border-left: 5px solid #3498db;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .image-container {
            text-align: center;
            margin: 30px 0;
        }
        .image-container img {
            max-width: 90%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        .caution {
            color: #c0392b;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚀 아두이노 RC카 교실 6주차 교재: RC카 '자율 주행'의 첫걸음 (장애물 회피)</h1>

        <hr>

        <h2>💡 이번 주 학습 목표</h2>
        <ul>
            <li>지난주에 배운 **초음파 센서**의 데이터를 활용하여 RC카가 스스로 장애물을 인식하는 방법을 이해해요.</li>
            <li>센서 값을 기반으로 RC카가 장애물을 피해 주행하는 **장애물 회피 알고리즘**을 구현해요.</li>
            <li>**서보 모터**를 활용하여 초음파 센서가 좌우를 탐색하며 주변 환경을 인식하도록 만들어요.</li>
            <li>자율 주행의 기초가 되는 센서 데이터 기반의 조건 판단 및 제어 로직을 익혀요.</li>
        </ul>

        <hr>

        <h2>1회차: 서보와 초음파 센서를 활용한 전방 탐색 시스템</h2>

        <h3>🔍 1. 서보 모터로 초음파 센서 좌우 살펴보기</h3>
        <p>지난 4주차에 초음파 센서로 거리를 측정하는 방법을 배웠고, 3주차에 서보 모터로 RC카의 조향을 제어했어요. 이번 회차에서는 이 두 가지를 결합하여 RC카가 고정된 앞만 보는 것이 아니라, **서보 모터 위에 초음파 센서를 장착**해서 좌우를 탐색하며 장애물을 더 넓은 범위에서 감지할 수 있도록 만들 거예요. 마치 RC카에 고개를 좌우로 돌리는 '눈'을 달아주는 것과 같아요.</p>
        <div class="image-container">
            <img src="servo_ultrasonic_assembly.png" alt="서보 모터와 초음파 센서 결합 이미지">
            <p><i>(SG90 서보 모터 위에 HC-SR04 초음파 센서가 장착된 모습의 실제 사진 또는 렌더링 이미지를 삽입해 주세요. 브래킷 등으로 고정된 모습이 보이면 좋습니다.)</i></p>
        </div>

        <h3>⚙️ 2. 회로 연결하기: 서보 + 초음파 센서 통합 연결</h3>
        <p>이번 회로 연결은 3주차 서보 모터 연결과 4주차 초음파 센서 연결을 합친 형태입니다.</p>
        <h4>준비물:</h4>
        <ul>
            <li>아두이노 우노 보드</li>
            <li>브레드보드</li>
            <li>HC-SR04 초음파 센서 모듈 1개</li>
            <li>SG90 서보 모터 1개</li>
            <li>점퍼선 (수-수)</li>
        </ul>
        <h4>회로 연결 순서:</h4>
        <ol>
            <li>**브레드보드 전원 연결**:
                <ul>
                    <li>아두이노의 **GND 핀**에서 브레드보드의 **파란색 (-) 라인**에 연결합니다.</li>
                    <li>아두이노의 **5V 핀**에서 브레드보드의 **빨간색 (+) 라인**에 연결합니다.</li>
                </ul>
            </li>
            <li>**초음파 센서 연결**:
                <ul>
                    <li>HC-SR04 센서의 **VCC 핀**을 브레드보드의 **빨간색 (+) 라인(5V)**에 연결합니다.</li>
                    <li>HC-SR04 센서의 **GND 핀**을 브레드보드의 **파란색 (-) 라인(GND)**에 연결합니다.</li>
                    <li>HC-SR04 센서의 **Trig 핀**을 아두이노의 **디지털 핀 11번**에 연결합니다.</li>
                    <li>HC-SR04 센서의 **Echo 핀**을 아두이노의 **디지털 핀 12번**에 연결합니다.</li>
                </ul>
            </li>
            <li>**서보 모터 연결**:
                <ul>
                    <li>서보 모터의 **VCC (빨간색) 핀**을 브레드보드의 **빨간색 (+) 라인(5V)**에 연결합니다.</li>
                    <li>서보 모터의 **GND (갈색 또는 검은색) 핀**을 브레드보드의 **파란색 (-) 라인(GND)**에 연결합니다.</li>
                    <li>서보 모터의 **신호 (주황색 또는 노란색) 핀**을 아두이노의 **디지털 핀 9번 (PWM 지원 핀)**에 연결합니다.</li>
                </ul>
            </li>
        </ol>
        <div class="image-container">
            <img src="arduino_servo_ultrasonic_circuit.png" alt="아두이노 서보 모터와 초음파 센서 통합 연결 회로도">
            <p><i>(아두이노, 브레드보드, 서보 모터, 초음파 센서가 모두 연결된 정확한 회로도 이미지를 삽입해 주세요. 각 핀의 연결을 명확히 보여주세요.)</i></p>
        </div>
        <p class="caution"><b>주의!</b> 초음파 센서와 서보 모터 모두 5V 전원을 사용하지만, 만약 불안정하거나 오작동이 있다면 별도의 외부 5V 전원을 사용하거나, 아두이노 보드에 충분한 전원이 공급되는지 확인해야 합니다.</p>

        <h3>📝 3. 코딩하기: 서보 모터로 초음파 센서 좌우 탐색</h3>
        <p>서보 모터를 움직여 초음파 센서로 다양한 각도에서 거리를 측정하고 시리얼 모니터에 출력하는 코드예요.</p>
        <pre><code class="language-cpp">// 아두이노 RC카 교실 - 6주차 1회차: 서보 모터로 초음파 센서 좌우 탐색 예제

#include &lt;Servo.h&gt; // 서보 라이브러리 포함

// 초음파 센서 핀 설정 (4주차와 동일)
const int trigPin = 11; 
const int echoPin = 12;

// 서보 모터 핀 설정 (3주차와 유사)
Servo myServo;
const int servoPin = 9; // 서보 신호선 연결 핀 (PWM 핀 사용)

void setup() {
  Serial.begin(9600);
  Serial.println("서보 모터 + 초음파 센서 탐색 시작!");

  // 초음파 센서 핀 모드 설정
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);

  // 서보 모터 연결
  myServo.attach(servoPin);
  myServo.write(90); // 서보 모터 초기 위치 (중앙 90도)
  delay(1000); // 서보가 중앙으로 이동할 시간
}

void loop() {
  // 1. 오른쪽 탐색 (각도: 180도 -> 0도)
  for (int angle = 180; angle >= 0; angle -= 15) { // 15도씩 감소
    myServo.write(angle); // 서보 모터 각도 설정
    delay(50); // 서보가 움직이는 시간 대기

    float distance = measureDistance(); // 거리 측정 함수 호출
    Serial.print("각도: ");
    Serial.print(angle);
    Serial.print("도, 거리: ");
    Serial.print(distance);
    Serial.println(" cm");
    delay(100); // 다음 측정까지 대기
  }

  // 2. 왼쪽 탐색 (각도: 0도 -> 180도)
  for (int angle = 0; angle <= 180; angle += 15) { // 15도씩 증가
    myServo.write(angle); // 서보 모터 각도 설정
    delay(50); // 서보가 움직이는 시간 대기

    float distance = measureDistance(); // 거리 측정 함수 호출
    Serial.print("각도: ");
    Serial.print(angle);
    Serial.print("도, 거리: ");
    Serial.print(distance);
    Serial.println(" cm");
    delay(100); // 다음 측정까지 대기
  }
}

// 초음파 센서로 거리를 측정하는 함수 (4주차 코드 재활용)
float measureDistance() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);

  long duration = pulseIn(echoPin, HIGH);
  float distanceCm = duration * 0.034 / 2;
  
  // 측정 오류 방지를 위한 값 필터링 (너무 작거나 큰 값 제외)
  if (distanceCm < 0 || distanceCm > 400) { // 센서 유효 범위 (대략 2cm ~ 400cm)
    return 400; // 유효하지 않은 값은 최대 거리로 간주
  }
  return distanceCm;
}
</code></pre>
        <h4>코딩 용어 상세 설명:</h4>
        <ul>
            <li><span class="highlight"><code>for (int angle = 180; angle >= 0; angle -= 15)</code></span>: <code>for</code> 반복문은 특정 횟수만큼 코드를 반복 실행할 때 사용해요. 여기서는 <code>angle</code> 변수를 180도부터 0도까지 15도씩 감소시키면서 반복합니다.</li>
            <li><span class="highlight"><code>myServo.write(angle);</code></span>: 서보 모터를 <code>angle</code> 변수에 해당하는 각도로 움직입니다.</li>
            <li><span class="highlight"><code>float distance = measureDistance();</code></span>: <code>measureDistance()</code>라는 사용자 정의 함수를 호출하여 초음파 센서로 거리를 측정한 후, 그 값을 <code>distance</code> 변수에 저장합니다. 이렇게 함수를 만들면 코드를 더 깔끔하게 정리하고 재사용하기 편리해요.</li>
            <li>**<code>measureDistance()</code> 함수 내부**: 4주차에 배운 초음파 센서 거리 측정 코드를 그대로 가져와 재활용했어요.</li>
            <li><span class="highlight"><code>if (distanceCm < 0 || distanceCm > 400)</code></span>: 초음파 센서가 간혹 비정상적인 값을 반환할 때가 있어요. 이를 필터링하여 유효하지 않은 값은 특정 값(여기서는 400cm)으로 처리하여 오류를 줄이는 코드입니다. <code>||</code>는 '또는'을 의미하는 논리 연산자입니다.</li>
        </ul>

        <h3>✅ 4. 결과 확인</h3>
        <ol>
            <li>코드를 아두이노에 업로드합니다.</li>
            <li>시리얼 모니터를 엽니다.</li>
            <li>서보 모터에 장착된 초음파 센서가 좌우로 움직이면서 각 각도에서의 측정 거리가 시리얼 모니터에 출력되는지 확인합니다. 센서 앞에 손이나 물체를 대어보면서 거리가 바뀌는지 테스트해 보세요.</li>
        </ol>
        <div class="project-idea">
            <h4>⭐ 스스로 해보기!</h4>
            <ul>
                <li>서보 모터의 회전 각도 범위(<code>0</code>~<code>180</code>)와 증가/감소 단위를 조절해 보세요. (예: 5도씩 움직이도록)</li>
                <li>측정된 거리에 따라 시리얼 모니터에 '장애물 감지!'와 같은 메시지를 출력해 보세요. (예: 30cm 이하면 메시지 출력)</li>
                <li>서보 모터의 움직임 속도를 더 빠르게 또는 느리게 조절해 보세요. (<code>delay()</code> 값 조정)</li>
            </ul>
        </div>

        <hr>
        <br>

        <h2>2회차: RC카 장애물 회피 자율 주행 알고리즘 구현</h2>

        <h3>🤖 1. 장애물 회피 알고리즘 구상</h3>
        <p>이제 RC카가 스스로 장애물을 피해서 주행하는 **자율 주행의 기초**를 만들어 볼 거예요. 가장 기본적인 장애물 회피 알고리즘은 다음과 같습니다.</p>
        <ol>
            <li>평소에는 **직진**한다.</li>
            <li>초음파 센서로 **전방에 장애물이 감지**되면 정지한다.</li>
            <li>**서보 모터를 움직여 좌우를 탐색**한다. (예: 오른쪽 45도, 왼쪽 135도, 중앙 90도)</li>
            <li>각 방향의 측정된 거리를 비교하여 **가장 먼(장애물이 없는) 방향으로 회전**한다.</li>
            <li>회전한 후 다시 직진한다.</li>
            <li>이 과정을 반복한다.</li>
        </ol>
        <p>이 알고리즘을 구현하기 위해, 1회차에서 만든 서보 + 초음파 센서 시스템과 3주차에서 만든 RC카 모터 제어 함수들을 통합할 거예요.</p>

        <h3>⚙️ 2. 통합 회로 연결: 모든 부품 연결</h3>
        <p>이제 아두이노 RC카에 필요한 모든 부품들을 연결합니다. (DC 모터, 서보 모터, 초음파 센서, 모터 드라이버, 배터리 등)</p>
        <h4>준비물:</h4>
        <ul>
            <li>아두이노 우노 보드</li>
            <li>L298N 모터 드라이버 모듈 1개</li>
            <li>DC 모터 2개</li>
            <li>SG90 서보 모터 1개 (초음파 센서 고정용)</li>
            <li>HC-SR04 초음파 센서 모듈 1개</li>
            <li>9V 건전지 및 건전지 스냅 (모터 드라이버용 외부 전원)</li>
            <li>점퍼선 (수-수)</li>
            <li>브레드보드 (선택 사항, 회로 정리에 도움)</li>
        </ul>
        <h4>회로 연결 순서:</h4>
        <ol>
            <li>**전원 및 접지 연결**:
                <ul>
                    <li>아두이노 GND -> L298N GND -> 초음파 센서 GND -> 서보 GND (모두 연결)</li>
                    <li>아두이노 5V -> 초음파 센서 VCC -> 서보 VCC (모두 연결)</li>
                    <li>9V 배터리 (+) -> L298N +12V</li>
                    <li>9V 배터리 (-) -> L298N GND (아두이노 GND와 이미 연결됨)</li>
                </ul>
            </li>
            <li>**DC 모터 연결 (L298N)**: (3주차 1회차와 동일)
                <ul>
                    <li>좌측 모터: OUT1, OUT2</li>
                    <li>우측 모터: OUT3, OUT4</li>
                    <li>아두이노 핀 7 -> IN1</li>
                    <li>아두이노 핀 6 -> IN2</li>
                    <li>아두이노 핀 5 -> IN3</li>
                    <li>아두이노 핀 4 -> IN4</li>
                    <li>아두이노 핀 9 (PWM) -> ENA (좌측 모터 속도)</li>
                    <li>아두이노 핀 10 (PWM) -> ENB (우측 모터 속도)</li>
                </ul>
            </li>
            <li>**서보 모터 연결**: (6주차 1회차, 핀 변경!)
                <ul>
                    <li>서보 신호선 -> 아두이노 핀 8 (다른 PWM 핀인 9번은 모터 ENA에 사용했으므로 다른 핀 사용)</li>
                </ul>
            </li>
            <li>**초음파 센서 연결**: (6주차 1회차와 동일)
                <ul>
                    <li>초음파 Trig 핀 -> 아두이노 핀 11</li>
                    <li>초음파 Echo 핀 -> 아두이노 핀 12</li>
                </ul>
            </li>
        </ol>
        <div class="image-container">
            <img src="arduino_rc_car_obstacle_avoidance_full_circuit.png" alt="아두이노 RC카 장애물 회피 전체 회로도">
            <p><i>(아두이노, L298N, DC 모터 2개, 서보 모터, 초음파 센서, 배터리가 모두 연결된 복잡한 전체 회로도 이미지를 삽입해 주세요.)</i></p>
        </div>
        <p class="caution"><b>주의!</b> 핀 번호가 변경되었으니 코드를 작성할 때 핀 번호를 정확히 맞춰주세요. 특히 서보 모터 핀은 9번 대신 8번으로 변경되었습니다. (PWM 기능이 필요 없는 핀으로 변경 가능).</p>

        <h3>📝 3. 코딩하기: RC카 장애물 회피 주행</h3>
        <p>앞서 구상한 알고리즘을 아두이노 코드로 구현합니다. <code>measureDistance()</code> 함수를 재활용하고, RC카의 움직임을 제어하는 함수들을 사용합니다.</p>
        <pre><code class="language-cpp">// 아두이노 RC카 교실 - 6주차 2회차: RC카 장애물 회피 자율 주행 예제

#include &lt;Servo.h&gt; // 서보 라이브러리 포함

// ======= 모터 드라이버 핀 설정 (3주차 1회차와 동일) =======
const int motor1_IN1 = 7; 
const int motor1_IN2 = 6;
const int motor1_ENA = 9;  // PWM 핀

const int motor2_IN3 = 5;
const int motor2_IN4 = 4;
const int motor2_ENB = 10; // PWM 핀

int motorSpeed = 150; // RC카 주행 속도 (0~255)

// ======= 초음파 센서 핀 설정 (4주차와 동일) =======
const int trigPin = 11; 
const int echoPin = 12;

// ======= 서보 모터 핀 설정 (6주차 1회차, 핀 변경!) =======
Servo myServo;
const int servoPin = 8; // 서보 신호선 연결 핀 (9번 핀이 모터에 사용되므로 8번 사용)

// ======= 장애물 감지 임계값 설정 =======
const int OBSTACLE_DISTANCE_CM = 25; // 이 거리 이하면 장애물로 판단 (cm)

void setup() {
  Serial.begin(9600);
  Serial.println("RC카 장애물 회피 자율 주행 시작!");

  // 모터 핀 설정
  pinMode(motor1_IN1, OUTPUT);
  pinMode(motor1_IN2, OUTPUT);
  pinMode(motor1_ENA, OUTPUT);
  pinMode(motor2_IN3, OUTPUT);
  pinMode(motor2_IN4, OUTPUT);
  pinMode(motor2_ENB, OUTPUT);
  stopMotors(); // 초기 모터 정지

  // 초음파 센서 핀 모드 설정
  pinMode(trigPin, OUTPUT);
  pinMode(echoPin, INPUT);

  // 서보 모터 연결 및 초기 위치 설정
  myServo.attach(servoPin);
  myServo.write(90); // 서보 모터 초기 위치 (중앙 90도)
  delay(1000); // 서보가 중앙으로 이동할 시간
}

void loop() {
  int distanceForward = measureDistance(); // 정면 거리 측정

  Serial.print("정면 거리: ");
  Serial.print(distanceForward);
  Serial.println(" cm");

  // 정면에 장애물이 감지되면 (OBSTACLE_DISTANCE_CM 이하)
  if (distanceForward <= OBSTACLE_DISTANCE_CM) {
    stopMotors(); // 즉시 정지
    Serial.println("!!! 장애물 감지! 회피 경로 탐색 중...");
    delay(500); // 잠시 대기

    // 후진하여 장애물에서 멀어지기 (필수 아님, 더 부드러운 회피를 위해 추가)
    moveBackward();
    delay(500); // 0.5초 후진
    stopMotors();
    delay(200); // 정지 대기

    // 좌우 탐색하여 가장 먼 방향 찾기
    int distanceLeft = lookLeft();
    delay(100); // 각도 변경 후 측정 대기
    int distanceRight = lookRight();
    delay(100); // 각도 변경 후 측정 대기
    
    myServo.write(90); // 다시 중앙으로 서보 복귀
    delay(300);

    Serial.print("왼쪽 거리: "); Serial.print(distanceLeft); Serial.println(" cm");
    Serial.print("오른쪽 거리: "); Serial.print(distanceRight); Serial.println(" cm");

    // 더 먼 방향으로 회전
    if (distanceLeft > distanceRight) {
      Serial.println("왼쪽으로 회전!");
      turnLeft(); // RC카를 왼쪽으로 회전
      delay(800); // 회전 시간 (조절 필요)
      stopMotors();
    } else if (distanceRight > distanceLeft) {
      Serial.println("오른쪽으로 회전!");
      turnRight(); // RC카를 오른쪽으로 회전
      delay(800); // 회전 시간 (조절 필요)
      stopMotors();
    } else { // 좌우 거리가 비슷할 경우 (선택 사항: 한쪽으로 고정하거나 랜덤)
      Serial.println("좌우 거리 비슷, 오른쪽으로 회전!");
      turnRight(); // 기본적으로 오른쪽으로 회전
      delay(800);
      stopMotors();
    }
    Serial.println("회피 완료! 다시 전진 시작.");
    moveForward(); // 회피 후 다시 전진
    delay(500); // 잠시 전진 대기
  } else {
    // 장애물이 없으면 계속 전진
    moveForward();
  }
}

// 초음파 센서로 거리를 측정하는 함수 (6주차 1회차에서 재활용)
float measureDistance() {
  digitalWrite(trigPin, LOW);
  delayMicroseconds(2);
  digitalWrite(trigPin, HIGH);
  delayMicroseconds(10);
  digitalWrite(trigPin, LOW);

  long duration = pulseIn(echoPin, HIGH);
  float distanceCm = duration * 0.034 / 2;
  
  // 측정 오류 방지를 위한 값 필터링
  if (distanceCm < 0 || distanceCm > 400) { 
    return 400; // 유효하지 않은 값은 최대 거리로 간주
  }
  return distanceCm;
}

// 왼쪽을 탐색하는 함수
int lookLeft() {
  myServo.write(170); // 왼쪽 끝 (거의 180도 가까이)
  delay(300); // 서보가 움직일 시간
  return measureDistance();
}

// 오른쪽을 탐색하는 함수
int lookRight() {
  myServo.write(10); // 오른쪽 끝 (거의 0도 가까이)
  delay(300); // 서보가 움직일 시간
  return measureDistance();
}

// RC카 전진 함수 (3주차와 동일, 속도 변수 사용)
void moveForward() {
  digitalWrite(motor1_IN1, HIGH);
  digitalWrite(motor1_IN2, LOW);
  analogWrite(motor1_ENA, motorSpeed);

  digitalWrite(motor2_IN3, HIGH); 
  digitalWrite(motor2_IN4, LOW);
  analogWrite(motor2_ENB, motorSpeed);
}

// RC카 후진 함수 (3주차와 동일, 속도 변수 사용)
void moveBackward() {
  digitalWrite(motor1_IN1, LOW);
  digitalWrite(motor1_IN2, HIGH);
  analogWrite(motor1_ENA, motorSpeed);

  digitalWrite(motor2_IN3, LOW); 
  digitalWrite(motor2_IN4, HIGH);
  analogWrite(motor2_ENB, motorSpeed);
}

// RC카 정지 함수 (3주차와 동일)
void stopMotors() {
  digitalWrite(motor1_IN1, LOW);
  digitalWrite(motor1_IN2, LOW);
  analogWrite(motor1_ENA, 0); 

  digitalWrite(motor2_IN3, LOW);
  digitalWrite(motor2_IN4, LOW);
  analogWrite(motor2_ENB, 0); 
}

// RC카 왼쪽으로 회전 함수 (제자리 회전 또는 좌측 바퀴만 정지)
void turnLeft() {
  digitalWrite(motor1_IN1, LOW); // 왼쪽 바퀴 후진
  digitalWrite(motor1_IN2, HIGH);
  analogWrite(motor1_ENA, motorSpeed);

  digitalWrite(motor2_IN3, HIGH); // 오른쪽 바퀴 전진
  digitalWrite(motor2_IN4, LOW);
  analogWrite(motor2_ENB, motorSpeed);
}

// RC카 오른쪽으로 회전 함수 (제자리 회전 또는 우측 바퀴만 정지)
void turnRight() {
  digitalWrite(motor1_IN1, HIGH); // 왼쪽 바퀴 전진
  digitalWrite(motor1_IN2, LOW);
  analogWrite(motor1_ENA, motorSpeed);

  digitalWrite(motor2_IN3, LOW); // 오른쪽 바퀴 후진
  digitalWrite(motor2_IN4, HIGH);
  analogWrite(motor2_ENB, motorSpeed);
}
</code></pre>
        <p class="note">**참고:** <code>turnLeft()</code>와 <code>turnRight()</code> 함수는 RC카의 종류(트랙션 방식)에 따라 다르게 구현될 수 있습니다. 위 코드는 좌우 바퀴가 반대 방향으로 회전하여 제자리에서 도는 방식입니다. 만약 조향 방식이 서보 모터로 앞바퀴를 조절하는 방식이라면, <code>myServo.write()</code>를 사용하여 조향 후 <code>moveForward()</code>를 실행해야 합니다.</p>
        <h4>코딩 용어 상세 설명:</h4>
        <ul>
            <li><span class="highlight"><code>OBSTACLE_DISTANCE_CM</code></span>: 장애물을 판단하는 기준 거리를 상수로 정의했어요. 이렇게 하면 나중에 값을 바꾸기 편리합니다.</li>
            <li><span class="highlight"><code>int distanceForward = measureDistance();</code></span>: 현재 서보가 바라보는 방향(초기에는 중앙)의 거리를 측정합니다.</li>
            <li><span class="highlight"><code>if (distanceForward <= OBSTACLE_DISTANCE_CM)</code></span>: 만약 정면 거리가 장애물 감지 임계값보다 작거나 같으면 장애물이 있다고 판단합니다.</li>
            <li><span class="highlight"><code>lookLeft()</code>, <code>lookRight()</code></span>: 서보 모터를 특정 각도로 움직여 해당 방향의 거리를 측정한 후 반환하는 새로운 함수를 만들었어요.</li>
            <li><span class="highlight"><code>if (distanceLeft > distanceRight)</code></span>: 왼쪽 거리가 오른쪽 거리보다 멀면 왼쪽으로 회전합니다. (더 넓은 공간이 왼쪽이라는 뜻)</li>
            <li><span class="highlight"><code>delay(800);</code></span>: 회전 시간이에요. RC카의 크기와 모터 속도에 따라 적절한 회전 시간을 직접 실험해서 찾아야 합니다. 이 시간이 RC카가 90도 회전하는 데 걸리는 시간과 비슷해야 해요.</li>
            <li>**회전 함수**: <code>turnLeft()</code>와 <code>turnRight()</code>는 RC카가 그 자리에서 회전(탱크 턴)하도록 좌우 바퀴의 회전 방향을 반대로 설정했어요. 만약 여러분의 RC카가 서보 모터로 앞바퀴 조향을 한다면, 서보 각도를 조절 후 전진하는 방식으로 바꿔야 합니다.</li>
        </ul>

        <h3>✅ 4. 결과 확인 및 자율 주행 테스트</h3>
        <ol>
            <li>코드를 아두이노에 업로드합니다.</li>
            <li>RC카를 넓은 공간에 두고 전원을 켜서 자율 주행이 시작되는지 확인합니다.</li>
            <li>앞에 손이나 상자 같은 장애물을 놓아 RC카가 이를 인식하고 피해서 주행하는지 관찰합니다.</li>
            <li>RC카가 회전하는 각도나 속도가 적절한지 확인하고, 필요에 따라 코드의 <code>delay()</code> 값이나 <code>motorSpeed</code> 값을 조절하여 최적의 동작을 찾습니다.</li>
        </ol>
        <p class="project-idea">
            <h4>⭐ 스스로 해보기!</h4>
            <ul>
                <li>RC카가 장애물을 피한 후 **항상 중앙으로 조향**한 다음 직진하도록 코드를 개선해 보세요.</li>
                <li>장애물 회피 후 바로 직진하지 않고, 잠시 멈춰서 다음 장애물이 없는지 다시 한번 전방을 탐색하는 로직을 추가해 보세요.</li>
                <li>RC카가 너무 자주 멈추거나 너무 멀리서 장애물을 감지한다면 <code>OBSTACLE_DISTANCE_CM</code> 값을 조절해 보세요.</li>
                <li>센서 값에 이상이 있을 때(예: 0cm 또는 너무 큰 값) <code>Serial.println("측정 오류!");</code> 메시지를 출력하도록 <code>measureDistance()</code> 함수를 개선해 보세요.</li>
            </ul>
        </p>

        <hr>

        <h2>❓ 궁금증 해결 시간</h2>
        <p>오늘 RC카가 스스로 장애물을 인식하고 피하는 '자율 주행'의 첫걸음을 떼었어요. 이제 RC카는 여러분의 명령 없이도 주변 환경에 반응하여 움직일 수 있는 스마트 로봇이 되었답니다! 혹시 이해가 잘 안 되거나 더 궁금한 점이 있나요? 무엇이든 질문해주세요!</p>

        <hr>

        <p>축하합니다! 아두이노 RC카 만들기 프로젝트의 여섯 번째 주도 성공적으로 마쳤어요. 자율 주행의 기초인 장애물 회피를 구현하며 RC카가 더욱 똑똑해졌답니다. 이제 RC카 프로젝트의 핵심적인 부분은 모두 다루었어요. 다음 시간에는 그동안 배운 지식들을 활용하여 나만의 RC카를 더욱 멋지고 똑똑하게 만드는 아이디어와 심화 학습에 대해 알아볼 거예요. 오늘 배운 장애물 회피 알고리즘을 잘 이해하고, 스스로 해보기 미션도 꼭 도전해 보세요!</p>
    </div>
</body>
</html>
